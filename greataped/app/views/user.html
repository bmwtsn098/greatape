<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ .Title }}</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
      crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col mb-3">
          <br />
          <h1 class="display-5">{{ .Title }}</h1>
          <br />
          <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="feed-tab"
                data-bs-toggle="tab"
                data-bs-target="#feed-tab-pane"
                type="button"
                role="tab"
                aria-controls="feed-tab-pane"
                aria-selected="true"
              >
                Feed
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="followers-tab"
                data-bs-toggle="tab"
                data-bs-target="#followers-tab-pane"
                type="button"
                role="tab"
                aria-controls="followers-tab-pane"
                aria-selected="false"
              >
                Followers
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="following-tab"
                data-bs-toggle="tab"
                data-bs-target="#following-tab-pane"
                type="button"
                role="tab"
                aria-controls="following-tab-pane"
                aria-selected="false"
              >
                Following
              </button>
            </li>
          </ul>
          <div class="tab-content" id="myTabContent">
            <div
              class="tab-pane fade show active"
              id="feed-tab-pane"
              role="tabpanel"
              aria-labelledby="feed-tab"
              tabindex="0"
            >
              <br />
              <ul id="feed"></ul>
            </div>
            <div
              class="tab-pane fade"
              id="followers-tab-pane"
              role="tabpanel"
              aria-labelledby="followers-tab"
              tabindex="0"
            >
              <div class="container">
                <br />
                <ul id="followers"></ul>
              </div>
            </div>
            <div
              class="tab-pane fade"
              id="following-tab-pane"
              role="tabpanel"
              aria-labelledby="following-tab"
              tabindex="0"
            >
              <br />
              <ul id="following"></ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      function refresh() {
        axios({
          method: "get",
          url: "/u/{{ .Username }}/outbox",
          headers: {
            Authorization: "Bearer " + localStorage.getItem("token"),
          },
        }).then(function (response) {
          const list = document.getElementById("feed");
          list.innerHTML = "";
          for (let i = 0; i < response.data.orderedItems.length; i++) {
            let item = document.createElement("li");
            item.innerHTML =
              "<article><em>From: " +
              response.data.orderedItems[i].object.attributedTo +
              "</em><hr><p>" +
              response.data.orderedItems[i].object.content +
              "</p></article>";
            list.appendChild(item);
          }
        });

        axios({
          method: "get",
          url: "/u/{{ .Username }}/followers",
          headers: {
            Authorization: "Bearer " + localStorage.getItem("token"),
          },
        }).then(function (response) {
          const list = document.getElementById("followers");
          list.innerHTML = "";
          for (let i = 0; i < response.data.orderedItems.length; i++) {
            let item = document.createElement("li");
            item.innerHTML =
              '<article><p><a href="' +
              response.data.orderedItems[i] +
              '">' +
              response.data.orderedItems[i] +
              "</a></p></article>";
            list.appendChild(item);
          }
        });

        axios({
          method: "get",
          url: "/u/{{ .Username }}/following",
          headers: {
            Authorization: "Bearer " + localStorage.getItem("token"),
          },
        }).then(function (response) {
          const list = document.getElementById("following");
          list.innerHTML = "";
          for (let i = 0; i < response.data.orderedItems.length; i++) {
            let item = document.createElement("li");
            item.innerHTML =
              '<article><p><a href="' +
              response.data.orderedItems[i] +
              '">' +
              response.data.orderedItems[i] +
              "</a></p></article>";
            list.appendChild(item);
          }
        });
      }

      refresh();
    </script>
  </body>
</html>
